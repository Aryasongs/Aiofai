<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OrinAI Chat</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script async src="https://cse.google.com/cse.js?cx=b7145043bbbac4427"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #343541;
            color: #ECECF1;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            -webkit-text-size-adjust: 100%;
        }
        
        input, textarea {
            font-size: 16px; /* Prevents iOS zoom */
        }
        
        .chat-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            background-color: #202123;
            width: 260px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            scroll-behavior: smooth;
        }
        
        .message {
            padding: 20px;
            display: flex;
            align-items: flex-start;
        }
        
        .user-message {
            background-color: #343541;
        }
        
        .ai-message {
            background-color: #444654;
        }
        
        .message-content {
            margin-left: 15px;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .input-area {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #343541;
            border-top: 1px solid #565869;
        }
        
        .input-container {
            max-width: 800px;
            width: 100%;
            position: relative;
        }
        
        .message-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border-radius: 6px;
            border: 1px solid #565869;
            background-color: #40414F;
            color: #ECECF1;
            font-size: 16px;
            resize: none;
            outline: none;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .message-input:focus {
            border-color: #10a37f;
            box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.2);
        }
        
        .send-button {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background: none;
            border: none;
            color: #ECECF1;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .send-button:hover {
            background-color: #565869;
        }
        
        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .user-avatar {
            background-color: #5436DA;
        }
        
        .ai-avatar {
            background-color: #10a37f;
        }
        
        .ai-avatar.orin4o {
            background-color: #FF5733;
        }
        
        .ai-avatar.o4mini {
            background-color: #33A1FF;
        }
        
        .ai-avatar.orin-4-2-mini {
            background-color: #8A33FF;
        }
        
        .ai-avatar.orin5o {
            background: linear-gradient(135deg, #FF5733, #8A33FF);
        }
        
        .new-chat-btn {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 1px solid #565869;
            border-radius: 6px;
            color: #ECECF1;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.2s;
            width: 90%;
            margin: 15px auto;
        }
        
        .new-chat-btn:hover {
            background-color: #2A2B32;
        }
        
        .model-selector {
            padding: 10px 15px;
            margin: 10px 15px;
            background-color: #202123;
            border: 1px solid #565869;
            border-radius: 6px;
            color: #ECECF1;
            width: calc(100% - 30px);
            cursor: pointer;
        }
        
        .model-selector:focus {
            outline: none;
            border-color: #10a37f;
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            margin-left: 5px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #ECECF1;
            margin: 0 2px;
            animation: typing-animation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing-animation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            30% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }
        
        .login-container {
            background-color: #343541;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-box {
            background-color: #202123;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .login-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #565869;
            background-color: #40414F;
            color: #ECECF1;
            font-size: 16px;
            outline: none;
        }
        
        .login-input:focus {
            border-color: #10a37f;
        }
        
        .login-button {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: none;
            border-radius: 6px;
            background-color: #10a37f;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .login-button:hover {
            background-color: #0d8c6d;
        }
        
        .google-login-button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #565869;
            border-radius: 6px;
            background-color: #202123;
            color: #ECECF1;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .google-login-button:hover {
            background-color: #2A2B32;
        }
        
        .google-icon {
            margin-right: 10px;
        }
        
        .error-message {
            color: #ff4d4f;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .toggle-auth {
            color: #10a37f;
            cursor: pointer;
            margin-top: 15px;
            text-align: center;
            display: block;
        }
        
        .toggle-auth:hover {
            text-decoration: underline;
        }
        
        .mobile-menu-button {
            display: none;
            background: none;
            border: none;
            color: #ECECF1;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -260px;
                top: 0;
                bottom: 0;
                z-index: 99;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .mobile-menu-button {
                display: block;
            }
            
            .main-content {
                padding-top: 50px;
            }
            
            .login-box {
                width: 90%;
                max-width: 350px;
                aspect-ratio: auto;
                padding: 20px;
            }
        }
        
        .logout-button {
            padding: 10px;
            background-color: #40414F;
            color: #ECECF1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 10px 15px;
        }
        
        .logout-button:hover {
            background-color: #565869;
        }
        
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #10a37f, #8A33FF, #33A1FF, #FF5733);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 8s ease infinite;
            background-size: 300% 300%;
        }
        
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .welcome-subtitle {
            font-size: 1.2rem;
            color: #ECECF1;
            margin-bottom: 30px;
            max-width: 600px;
        }
        
        .model-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .model-card {
            background-color: #202123;
            border-radius: 8px;
            padding: 20px;
            width: 200px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .model-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .model-icon {
            font-size: 30px;
            margin-bottom: 15px;
        }
        
        .orin4o-icon {
            color: #FF5733;
        }
        
        .o4mini-icon {
            color: #33A1FF;
        }
        
        .orin-4-2-mini-icon {
            color: #8A33FF;
        }
        
        .orin5o-icon {
            background: linear-gradient(135deg, #FF5733, #8A33FF);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .chat-history-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
        }
        
        .chat-history-item {
            padding: 8px 10px;
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .chat-history-item:hover {
            background-color: #2A2B32;
        }
        
        .chat-history-item.active {
            background-color: #343541;
        }
        
        .chat-icon {
            margin-right: 8px;
            font-size: 14px;
        }
        
        .source-link {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            color: #10a37f;
            text-decoration: none;
            border-top: 1px solid #10a37f;
            padding-top: 5px;
        }
        
        .source-link:hover {
            text-decoration: underline;
        }
        
        .usage-limit-container {
            background-color: rgba(0, 0, 0, 0.8);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .usage-limit-box {
            background-color: #202123;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .usage-limit-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #FF5733;
        }
        
        .usage-limit-message {
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .get-plus-button {
            background: linear-gradient(135deg, #FF5733, #8A33FF);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .get-plus-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 87, 51, 0.4);
        }
        
        .premium-plan-container {
            background-color: rgba(0, 0, 0, 0.8);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .premium-plan-box {
            background-color: #202123;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .premium-plan-title {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
            background: linear-gradient(135deg, #FF5733, #8A33FF);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .premium-plan-features {
            margin-bottom: 25px;
        }
        
        .premium-feature {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .feature-icon {
            color: #10a37f;
            margin-right: 10px;
        }
        
        .premium-plan-price {
            font-size: 28px;
            font-weight: 700;
            margin: 20px 0;
            text-align: center;
        }
        
        .premium-plan-price span {
            font-size: 16px;
            font-weight: 400;
            color: #ACACBE;
        }
        
        .buy-button {
            background: linear-gradient(135deg, #FF5733, #8A33FF);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .buy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 87, 51, 0.4);
        }
        
        .close-button {
            background-color: transparent;
            border: 1px solid #565869;
            color: #ECECF1;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        
        .close-button:hover {
            background-color: #2A2B32;
        }
        
        .search-result {
            border-left: 3px solid #10a37f;
            padding-left: 10px;
            margin-top: 10px;
        }
        
        .gcse-search {
            display: none;
        }
        
        .user-email {
            font-size: 14px;
            color: #ACACBE;
            margin-top: 10px;
            text-align: center;
        }
        
        .payment-status {
            font-size: 14px;
            color: #FF5733;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="login-screen" class="login-container">
            <div class="login-box">
                <h2 class="text-2xl font-bold mb-6 text-center">Welcome to OrinAI</h2>
                <div id="auth-error" class="error-message hidden"></div>
                
                <div id="login-form">
                    <input type="email" id="login-email" class="login-input" placeholder="Email">
                    <input type="password" id="login-password" class="login-input" placeholder="Password">
                    <button id="login-button" class="login-button">Log In</button>
                    
                    <div class="text-center my-4 text-gray-400">or</div>
                    
                    <button id="google-login-button" class="google-login-button">
                        <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48">
                            <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path>
                            <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path>
                            <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path>
                            <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                        </svg>
                        Continue with Google
                    </button>
                    
                    <div class="toggle-auth" id="switch-to-signup">Don't have an account? Sign up</div>
                </div>
                
                <div id="signup-form" class="hidden">
                    <input type="email" id="signup-email" class="login-input" placeholder="Email">
                    <input type="password" id="signup-password" class="login-input" placeholder="Password">
                    <button id="signup-button" class="login-button">Sign Up</button>
                    
                    <div class="text-center my-4 text-gray-400">or</div>
                    
                    <button id="google-signup-button" class="google-login-button">
                        <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48">
                            <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path>
                            <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path>
                            <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path>
                            <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                        </svg>
                        Continue with Google
                    </button>
                    
                    <div class="toggle-auth" id="switch-to-login">Already have an account? Log in</div>
                </div>
            </div>
        </div>
        
        <!-- Chat Interface -->
        <div id="chat-interface" class="chat-container hidden">
            <button class="mobile-menu-button" id="mobile-menu-button">‚ò∞</button>
            
            <div class="sidebar" id="sidebar">
                <button class="new-chat-btn" id="new-chat-btn">
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New chat
                </button>
                
                <div class="mt-5 px-3">
                    <label class="block text-sm text-gray-400 mb-2">Select Model</label>
                    <select id="model-selector" class="model-selector">
                        <option value="orin4o" selected>Orin4o</option>
                        <option value="o4mini">O4mini</option>
                        <option value="orin-4-2-mini">Orin-4.2-mini</option>
                        <option value="orin5o" disabled>Orin5o (Plus Only)</option>
                    </select>
                </div>
                
                <div class="chat-history-container">
                    <div class="text-sm text-gray-400 mb-2">Chat History</div>
                    <div id="chat-history" class="space-y-2"></div>
                </div>
                
                <div class="mt-auto">
                    <div id="usage-count" class="text-xs text-gray-400 text-center mb-2">
                        Messages today: 0/90
                    </div>
                    <button id="logout-button" class="logout-button">Log out</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="chat-messages" id="chat-messages">
                    <div class="welcome-screen" id="welcome-screen">
                        <h1 class="welcome-title">Welcome to OrinAI</h1>
                        <p class="welcome-subtitle">Your advanced AI assistant powered by OrionTec. Ask me anything, search for information, or just chat!</p>
                        
                        <div class="model-features">
                            <div class="model-card">
                                <div class="model-icon orin4o-icon">‚óè</div>
                                <h3 class="text-lg font-semibold mb-2">Orin4o</h3>
                                <p class="text-sm text-gray-400">Advanced reasoning with creative capabilities</p>
                            </div>
                            
                            <div class="model-card">
                                <div class="model-icon o4mini-icon">‚óè</div>
                                <h3 class="text-lg font-semibold mb-2">O4mini</h3>
                                <p class="text-sm text-gray-400">Fast responses with balanced performance</p>
                            </div>
                            
                            <div class="model-card">
                                <div class="model-icon orin-4-2-mini-icon">‚óè</div>
                                <h3 class="text-lg font-semibold mb-2">Orin-4.2-mini</h3>
                                <p class="text-sm text-gray-400">Specialized knowledge with technical expertise</p>
                            </div>
                            
                            <div class="model-card">
                                <div class="model-icon orin5o-icon">‚óè</div>
                                <h3 class="text-lg font-semibold mb-2">Orin5o</h3>
                                <p class="text-sm text-gray-400">Premium model with enhanced intelligence (Plus Only)</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="input-area">
                    <div class="input-container">
                        <textarea id="message-input" class="message-input" placeholder="Message OrinAI..." rows="1"></textarea>
                        <button id="send-button" class="send-button">
                            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Usage Limit Modal -->
        <div id="usage-limit-modal" class="usage-limit-container hidden">
            <div class="usage-limit-box">
                <h3 class="usage-limit-title">Daily Limit Reached</h3>
                <p class="usage-limit-message">
                    You've reached your daily limit of 90 messages. Your limit will reset after 12 hours at <span id="reset-time"></span>.
                </p>
                <button id="get-plus-button" class="get-plus-button">Get OrinAI Plus</button>
            </div>
        </div>
        
        <!-- Premium Plan Modal -->
        <div id="premium-plan-modal" class="premium-plan-container hidden">
            <div class="premium-plan-box">
                <h3 class="premium-plan-title">OrinAI Plus</h3>
                <div class="premium-plan-features">
                    <div class="premium-feature">
                        <span class="feature-icon">‚úì</span>
                        <span>Unlimited messages - no daily limits</span>
                    </div>
                    <div class="premium-feature">
                        <span class="feature-icon">‚úì</span>
                        <span>Access to Orin5o - our most advanced model</span>
                    </div>
                    <div class="premium-feature">
                        <span class="feature-icon">‚úì</span>
                        <span>Priority access during high demand</span>
                    </div>
                    <div class="premium-feature">
                        <span class="feature-icon">‚úì</span>
                        <span>Enhanced search capabilities</span>
                    </div>
                    <div class="premium-feature">
                        <span class="feature-icon">‚úì</span>
                        <span>Faster response times</span>
                    </div>
                </div>
                
                <div class="premium-plan-price">
                    ‚Çπ120 <span>/ month</span>
                </div>
                
                <div id="user-email" class="user-email"></div>
                <div id="payment-status" class="payment-status hidden">Waiting for payment confirmation...</div>
                
                <button id="buy-button" class="buy-button">Buy OrinAI Plus</button>
                <button id="close-premium-modal" class="close-button">Maybe Later</button>
            </div>
        </div>
    </div>
    
    <div class="gcse-search"></div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAl8eI-_8Ew9va0KPV8p4D2hc9WUTGiwuI",
            authDomain: "chat-d647c.firebaseapp.com",
            databaseURL: "https://chat-d647c-default-rtdb.firebaseio.com",
            projectId: "chat-d647c",
            storageBucket: "chat-d647c.firebasestorage.app",
            messagingSenderId: ".",
            appId: "1:.:web:7248a0983dcf0d45a87418",
            measurementId: "G-5RFLRYTLCN"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const chatInterface = document.getElementById('chat-interface');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToLogin = document.getElementById('switch-to-login');
        const authError = document.getElementById('auth-error');
        const loginButton = document.getElementById('login-button');
        const signupButton = document.getElementById('signup-button');
        const googleLoginButton = document.getElementById('google-login-button');
        const googleSignupButton = document.getElementById('google-signup-button');
        const logoutButton = document.getElementById('logout-button');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const welcomeScreen = document.getElementById('welcome-screen');
        const newChatBtn = document.getElementById('new-chat-btn');
        const modelSelector = document.getElementById('model-selector');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const sidebar = document.getElementById('sidebar');
        const chatHistory = document.getElementById('chat-history');
        const usageCount = document.getElementById('usage-count');
        const usageLimitModal = document.getElementById('usage-limit-modal');
        const resetTime = document.getElementById('reset-time');
        const getPlusButton = document.getElementById('get-plus-button');
        const premiumPlanModal = document.getElementById('premium-plan-modal');
        const buyButton = document.getElementById('buy-button');
        const closePremiumModal = document.getElementById('close-premium-modal');
        const userEmailDisplay = document.getElementById('user-email');
        const paymentStatus = document.getElementById('payment-status');
        
        // Global variables
        let currentUser = null;
        let currentChatId = null;
        let messageCount = 0;
        let isPlusUser = false;
        let searchResults = {};
        let aiResponses = {};
        let restrictedCommands = {};
        
        // Load AI responses from Firebase
        function loadAIResponses() {
            const responsesRef = database.ref('ai_responses');
            responsesRef.once('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    aiResponses = data;
                } else {
                    // Initialize with default responses
                    initializeDefaultResponses();
                }
            });
        }
        
        // Load restricted commands from Firebase
        function loadRestrictedCommands() {
            const commandsRef = database.ref('restricted_commands');
            commandsRef.once('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    restrictedCommands = data;
                } else {
                    // Initialize with default restricted commands
                    initializeDefaultRestrictedCommands();
                }
            });
        }
        
        // Initialize default AI responses
        function initializeDefaultResponses() {
            const defaultResponses = {
                greetings: {
                    orin5o: "Hello there! I'm OrinAI running on the premium Orin5o model. I'm designed to provide exceptionally intelligent and nuanced responses. How can I assist you today?",
                    orin4o: "Hey! I'm OrinAI using the Orin4o model. What's on your mind today? I'm here to chat about pretty much anything!",
                    o4mini: "Hi there! I'm OrinAI running on O4mini. Quick and friendly responses are my specialty! What can I help you with?",
                    "orin-4-2-mini": "Greetings. I am OrinAI operating on the Orin-4.2-mini model. I specialize in technical knowledge and precise information. How may I assist you today?"
                },
                introductions: {
                    orin5o: "I'm OrinAI, powered by the premium Orin5o model - the most advanced AI in the OrionTec lineup. I combine deep reasoning, creative thinking, and conversational fluency to provide comprehensive assistance. I'm trained on a vast knowledge base and can help with complex questions, creative tasks, and nuanced discussions. How can I assist you today?",
                    orin4o: "I'm OrinAI, created by OrionTec. I'm running on the Orin4o model, which is designed for natural conversations and helpful responses. I can answer questions, chat about various topics, and help you find information. What would you like to talk about?",
                    o4mini: "Hey! I'm OrinAI, developed by OrionTec. You're chatting with me on the O4mini model - I'm designed to be quick and conversational! I can answer questions, have casual conversations, and help with various tasks. What's up?",
                    "orin-4-2-mini": "I am OrinAI, a product of OrionTec, currently operating on the Orin-4.2-mini model. This model is optimized for technical accuracy and precise information retrieval. I excel at providing factual information and technical explanations. How may I be of service?"
                },
                // Add more response categories as needed
            };
            
            // Save to Firebase
            const responsesRef = database.ref('ai_responses');
            responsesRef.set(defaultResponses);
            
            // Set local variable
            aiResponses = defaultResponses;
        }
        
        // Initialize default restricted commands
        function initializeDefaultRestrictedCommands() {
            const defaultCommands = {
                sensitive_topics: ["porn", "xxx", "sex", "nude", "naked"],
                harmful_commands: ["hack", "steal", "attack", "exploit"],
                // Add more categories as needed
            };
            
            // Save to Firebase
            const commandsRef = database.ref('restricted_commands');
            commandsRef.set(defaultCommands);
            
            // Set local variable
            restrictedCommands = defaultCommands;
        }
        
        // Load initial data
        loadAIResponses();
        loadRestrictedCommands();
        
        // Toggle between login and signup forms
        switchToSignup.addEventListener('click', () => {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
            authError.classList.add('hidden');
            authError.textContent = '';
        });
        
        switchToLogin.addEventListener('click', () => {
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            authError.classList.add('hidden');
            authError.textContent = '';
        });
        
        // Login with email and password
        loginButton.addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showAuthError('Please enter both email and password');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Login successful
                    document.getElementById('login-email').value = '';
                    document.getElementById('login-password').value = '';
                    authError.classList.add('hidden');
                })
                .catch((error) => {
                    // Handle login errors
                    if (error.code === 'auth/invalid-login-credentials') {
                        showAuthError('Invalid password. Please try again.');
                    } else if (error.code === 'auth/user-not-found') {
                        showAuthError('No account found with this email.');
                    } else {
                        showAuthError('Login failed: ' + error.message);
                    }
                });
        });
        
        // Sign up with email and password
        signupButton.addEventListener('click', () => {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            if (!email || !password) {
                showAuthError('Please enter both email and password');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Password should be at least 6 characters');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signup successful
                    document.getElementById('signup-email').value = '';
                    document.getElementById('signup-password').value = '';
                    authError.classList.add('hidden');
                    
                    // Initialize user data
                    const user = userCredential.user;
                    initializeUserData(user);
                })
                .catch((error) => {
                    // Handle signup errors
                    if (error.code === 'auth/email-already-in-use') {
                        showAuthError('Already account on this email.');
                    } else {
                        showAuthError('Signup failed: ' + error.message);
                    }
                });
        });
        
        // Google Authentication
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        googleLoginButton.addEventListener('click', () => {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    const user = result.user;
                    const isNewUser = result.additionalUserInfo.isNewUser;
                    
                    if (isNewUser) {
                        initializeUserData(user);
                    }
                })
                .catch((error) => {
                    showAuthError('Google login failed: ' + error.message);
                });
        });
        
        googleSignupButton.addEventListener('click', () => {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    const user = result.user;
                    const isNewUser = result.additionalUserInfo.isNewUser;
                    
                    if (isNewUser) {
                        initializeUserData(user);
                    }
                })
                .catch((error) => {
                    showAuthError('Google signup failed: ' + error.message);
                });
        });
        
        // Initialize user data
        function initializeUserData(user) {
            const userRef = database.ref('users/' + user.uid);
            userRef.set({
                email: user.email,
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                isPlusUser: false,
                lastResetTime: firebase.database.ServerValue.TIMESTAMP,
                messageCount: 0
            });
        }
        
        // Logout
        logoutButton.addEventListener('click', () => {
            auth.signOut();
        });
        
        // Auth state change listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                currentUser = user;
                loginScreen.classList.add('hidden');
                chatInterface.classList.remove('hidden');
                
                // Load user data
                loadUserData(user.uid);
                
                // Load chat history
                loadChatList(user.uid);
                
                // Create new chat
                createNewChat();
            } else {
                // User is signed out
                currentUser = null;
                loginScreen.classList.remove('hidden');
                chatInterface.classList.add('hidden');
                chatMessages.innerHTML = '';
                welcomeScreen.style.display = 'flex';
                chatHistory.innerHTML = '';
                currentChatId = null;
                messageCount = 0;
                isPlusUser = false;
            }
        });
        
        // Load user data
        function loadUserData(userId) {
            const userRef = database.ref('users/' + userId);
            userRef.once('value', (snapshot) => {
                const userData = snapshot.val();
                
                if (userData) {
                    isPlusUser = userData.isPlusUser || false;
                    
                    // Check if we need to reset the message count
                    const lastResetTime = userData.lastResetTime || Date.now();
                    const currentTime = Date.now();
                    const twelveHoursInMs = 12 * 60 * 60 * 1000;
                    
                    if (currentTime - lastResetTime >= twelveHoursInMs) {
                        // Reset message count
                        userRef.update({
                            messageCount: 0,
                            lastResetTime: firebase.database.ServerValue.TIMESTAMP
                        });
                        messageCount = 0;
                    } else {
                        messageCount = userData.messageCount || 0;
                    }
                    
                    // Update usage count display
                    updateUsageCount();
                    
                    // Update model selector
                    updateModelSelector();
                }
            });
        }
        
        // Update usage count display
        function updateUsageCount() {
            usageCount.textContent = `Messages today: ${messageCount}/90`;
        }
        
        // Update model selector based on plus status
        function updateModelSelector() {
            const orin5oOption = modelSelector.querySelector('option[value="orin5o"]');
            
            if (isPlusUser) {
                orin5oOption.disabled = false;
                orin5oOption.textContent = "Orin5o";
            } else {
                orin5oOption.disabled = true;
                orin5oOption.textContent = "Orin5o (Plus Only)";
            }
        }
        
        // Show authentication error
        function showAuthError(message) {
            authError.textContent = message;
            authError.classList.remove('hidden');
        }
        
        // Mobile menu toggle
        mobileMenuButton.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });
        
        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            if (this.scrollHeight > 200) {
                this.style.height = '200px';
                this.style.overflowY = 'auto';
            } else {
                this.style.overflowY = 'hidden';
            }
        });
        
        // Send message on Enter key (but allow Shift+Enter for new line)
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // Send message button click
        sendButton.addEventListener('click', sendMessage);
        
        // New chat button
        newChatBtn.addEventListener('click', createNewChat);
        
        // Create new chat
        function createNewChat() {
            if (!currentUser) return;
            
            // Clear current chat
            welcomeScreen.style.display = 'flex';
            chatMessages.querySelectorAll('.message').forEach(msg => {
                if (msg.id !== 'welcome-screen') {
                    msg.remove();
                }
            });
            
            // Create new chat in Firebase
            const chatsRef = database.ref('chats/' + currentUser.uid);
            const newChatRef = chatsRef.push();
            
            newChatRef.set({
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                title: 'New Chat'
            });
            
            currentChatId = newChatRef.key;
            
            // Update chat history
            loadChatList(currentUser.uid);
        }
        
        // Load chat list
        function loadChatList(userId) {
            const chatsRef = database.ref('chats/' + userId);
            chatsRef.orderByChild('createdAt').once('value', (snapshot) => {
                // Clear chat history
                chatHistory.innerHTML = '';
                
                // Add chats to history
                const chats = [];
                snapshot.forEach((childSnapshot) => {
                    const chat = childSnapshot.val();
                    chat.id = childSnapshot.key;
                    chats.push(chat);
                });
                
                // Sort chats by creation time (newest first)
                chats.sort((a, b) => b.createdAt - a.createdAt);
                
                // Add chats to sidebar
                chats.forEach((chat) => {
                    const chatItem = document.createElement('div');
                    chatItem.className = 'chat-history-item';
                    chatItem.dataset.id = chat.id;
                    
                    if (chat.id === currentChatId) {
                        chatItem.classList.add('active');
                    }
                    
                    chatItem.innerHTML = `
                        <span class="chat-icon">üí¨</span>
                        <span class="chat-title">${chat.title}</span>
                    `;
                    
                    chatItem.addEventListener('click', () => {
                        loadChat(chat.id);
                    });
                    
                    chatHistory.appendChild(chatItem);
                });
                
                // If no current chat, set the first one
                if (!currentChatId && chats.length > 0) {
                    currentChatId = chats[0].id;
                    loadChat(currentChatId);
                }
            });
        }
        
        // Load chat
        function loadChat(chatId) {
            if (!currentUser) return;
            
            currentChatId = chatId;
            
            // Update active chat in sidebar
            const chatItems = chatHistory.querySelectorAll('.chat-history-item');
            chatItems.forEach(item => {
                if (item.dataset.id === chatId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Load messages
            const messagesRef = database.ref('messages/' + currentUser.uid + '/' + chatId);
            messagesRef.orderByChild('timestamp').once('value', (snapshot) => {
                // Clear chat messages
                welcomeScreen.style.display = 'none';
                chatMessages.querySelectorAll('.message').forEach(msg => {
                    if (msg.id !== 'welcome-screen') {
                        msg.remove();
                    }
                });
                
                // Add messages to chat
                const messages = [];
                snapshot.forEach((childSnapshot) => {
                    const message = childSnapshot.val();
                    messages.push(message);
                });
                
                // Sort messages by timestamp
                messages.sort((a, b) => a.timestamp - b.timestamp);
                
                // Add messages to chat
                messages.forEach((message) => {
                    if (message.sender === 'user' || message.sender === 'ai') {
                        addMessageToChat(message.sender, message.content, message.model, message.source);
                    }
                });
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
        
        // Send message function
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || !currentUser || !currentChatId) return;
            
            // Check if message contains restricted content
            if (containsRestrictedContent(message)) {
                addMessageToChat('user', message);
                messageInput.value = '';
                messageInput.style.height = 'auto';
                
                // Add AI response about restricted content
                const restrictedResponse = "I'm sorry, but I cannot respond to that request as it contains restricted content or commands. Please ask something else.";
                addMessageToChat('ai', restrictedResponse, modelSelector.value);
                
                // Save messages to Firebase
                const messagesRef = database.ref('messages/' + currentUser.uid + '/' + currentChatId);
                
                // Save user message
                messagesRef.push().set({
                    content: message,
                    sender: 'user',
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    model: modelSelector.value
                });
                
                // Save AI response
                messagesRef.push().set({
                    content: restrictedResponse,
                    sender: 'ai',
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    model: modelSelector.value
                });
                
                return;
            }
            
            // Check if user has reached daily limit
            if (messageCount >= 90 && !isPlusUser) {
                showUsageLimitModal();
                return;
            }
            
            // Hide welcome screen
            welcomeScreen.style.display = 'none';
            
            // Add user message to chat
            addMessageToChat('user', message);
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Get selected model
            const selectedModel = modelSelector.value;
            
            // Save message to Firebase
            const messagesRef = database.ref('messages/' + currentUser.uid + '/' + currentChatId);
            const newMessageRef = messagesRef.push();
            newMessageRef.set({
                content: message,
                sender: 'user',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                model: selectedModel
            });
            
            // Update chat title if it's the first message
            updateChatTitle(message);
            
            // Increment message count
            incrementMessageCount();
            
            // Check if it's a search query
            const isSearchQuery = message.toLowerCase().startsWith('search ');
            
            if (isSearchQuery) {
                // Handle search query
                const searchQuery = message.substring(7).trim();
                performSearch(searchQuery, selectedModel);
            } else {
                // Generate AI response based on selected model
                setTimeout(() => {
                    // Remove typing indicator
                    removeTypingIndicator();
                    
                    // Generate response based on model and message
                    let aiResponse = generateAIResponse(message, selectedModel);
                    
                    // Add AI response to chat
                    addMessageToChat('ai', aiResponse, selectedModel);
                    
                    // Save AI response to Firebase
                    const newResponseRef = messagesRef.push();
                    newResponseRef.set({
                        content: aiResponse,
                        sender: 'ai',
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        model: selectedModel
                    });
                }, getRandomResponseTime(selectedModel));
            }
        }
        
        // Check if message contains restricted content
        function containsRestrictedContent(message) {
            if (!restrictedCommands) return false;
            
            const lowerMessage = message.toLowerCase();
            
            // Check all categories of restricted content
            for (const category in restrictedCommands) {
                const restrictedTerms = restrictedCommands[category];
                for (const term of restrictedTerms) {
                    if (lowerMessage.includes(term)) {
                        return true;
                    }
                }
            }
            
            return false;
        }
        
        // Perform search
        function performSearch(query, model) {
            // Create a unique ID for this search
            const searchId = Date.now().toString();
            
            // Store the search query in our results object
            searchResults[searchId] = {
                query: query,
                results: []
            };
            
            // Use Google Custom Search API
            const searchElement = document.querySelector('.gcse-search');
            
            // Create a temporary input element to capture the search results
            const tempInput = document.createElement('input');
            tempInput.setAttribute('id', `search-input-${searchId}`);
            tempInput.style.display = 'none';
            document.body.appendChild(tempInput);
            
            // Create a custom search execution
            const customSearch = new google.search.cse.element.SearchControl({
                gname: 'gsearch',
                results: {
                    container: `search-input-${searchId}`
                }
            });
            
            // Add event listener for search complete
            document.addEventListener('gsc.searchresults', (event) => {
                if (event.detail && event.detail.results && event.detail.results.length > 0) {
                    // Process search results
                    const results = event.detail.results.slice(0, 8); // Get up to 8 results
                    
                    // Format search results
                    let formattedResults = `Here's what I found about "${query}":\n\n`;
                    
                    results.forEach((result, index) => {
                        formattedResults += `${index + 1}. ${result.title}\n${result.content}\n\n`;
                        
                        // Store result in our object
                        searchResults[searchId].results.push({
                            title: result.title,
                            content: result.content,
                            link: result.url
                        });
                    });
                    
                    // Add source link
                    formattedResults += `Source: Google Search`;
                    
                    // Remove typing indicator
                    removeTypingIndicator();
                    
                    // Add AI response to chat
                    addMessageToChat('ai', formattedResults, model, {
                        text: 'Google Search',
                        url: `https://www.google.com/search?q=${encodeURIComponent(query)}`
                    });
                    
                    // Save AI response to Firebase
                    const messagesRef = database.ref('messages/' + currentUser.uid + '/' + currentChatId);
                    const newResponseRef = messagesRef.push();
                    newResponseRef.set({
                        content: formattedResults,
                        sender: 'ai',
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        model: model,
                        source: {
                            text: 'Google Search',
                            url: `https://www.google.com/search?q=${encodeURIComponent(query)}`
                        }
                    });
                    
                    // Clean up
                    document.body.removeChild(tempInput);
                } else {
                    // No results found
                    const noResultsResponse = `I couldn't find any information about "${query}". Please try a different search query.`;
                    
                    // Remove typing indicator
                    removeTypingIndicator();
                    
                    // Add AI response to chat
                    addMessageToChat('ai', noResultsResponse, model);
                    
                    // Save AI response to Firebase
                    const messagesRef = database.ref('messages/' + currentUser.uid + '/' + currentChatId);
                    const newResponseRef = messagesRef.push();
                    newResponseRef.set({
                        content: noResultsResponse,
                        sender: 'ai',
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        model: model
                    });
                    
                    // Clean up
                    document.body.removeChild(tempInput);
                }
            }, { once: true });
            
            // Execute search
            customSearch.execute(query);
        }
        
        // Update chat title
        function updateChatTitle(message) {
            if (!currentUser || !currentChatId) return;
            
            const chatRef = database.ref('chats/' + currentUser.uid + '/' + currentChatId);
            chatRef.once('value', (snapshot) => {
                const chat = snapshot.val();
                
                if (chat && chat.title === 'New Chat') {
                    // Generate title from first message
                    let title = message.substring(0, 30);
                    if (message.length > 30) {
                        title += '...';
                    }
                    
                    // Update chat title
                    chatRef.update({
                        title: title
                    });
                    
                    // Update chat history
                    loadChatList(currentUser.uid);
                }
            });
        }
        
        // Increment message count
        function incrementMessageCount() {
            if (!currentUser) return;
            
            messageCount++;
            
            // Update usage count display
            updateUsageCount();
            
            // Update message count in Firebase
            const userRef = database.ref('users/' + currentUser.uid);
            userRef.update({
                messageCount: messageCount
            });
        }
        
        // Show usage limit modal
        function showUsageLimitModal() {
            // Calculate reset time
            const userRef = database.ref('users/' + currentUser.uid);
            userRef.once('value', (snapshot) => {
                const userData = snapshot.val();
                
                if (userData) {
                    const lastResetTime = userData.lastResetTime || Date.now();
                    const resetTimeMs = lastResetTime + (12 * 60 * 60 * 1000);
                    const resetDate = new Date(resetTimeMs);
                    
                    // Format reset time
                    const hours = resetDate.getHours().toString().padStart(2, '0');
                    const minutes = resetDate.getMinutes().toString().padStart(2, '0');
                    resetTime.textContent = `${hours}:${minutes}`;
                    
                    // Show modal
                    usageLimitModal.classList.remove('hidden');
                }
            });
        }
        
        // Get Plus button click
        getPlusButton.addEventListener('click', () => {
            // Hide usage limit modal
            usageLimitModal.classList.add('hidden');
            
            // Show premium plan modal with user email
            userEmailDisplay.textContent = currentUser.email;
            premiumPlanModal.classList.remove('hidden');
        });
        
        // Buy button click
        buyButton.addEventListener('click', () => {
            if (!currentUser) return;
            
            // Get user email
            const userEmail = currentUser.email;
            
            // Show payment status
            paymentStatus.classList.remove('hidden');
            buyButton.disabled = true;
            
            // Create UPI payment link
            const upiId = '7347417931@pthdfc';
            const amount = '120.00';
            const paymentDescription = `OrinAI Plus - ${userEmail}`;
            
            const upiLink = `upi://pay?pa=${upiId}&pn=OrinAI&am=${amount}&cu=INR&tn=${encodeURIComponent(paymentDescription)}`;
            
            // Open UPI link
            window.location.href = upiLink;
            
            // For demo purposes, we'll simulate a payment verification process
            // In a real app, you would have a server-side webhook to verify the payment
            
            // Create a payment record in Firebase
            const paymentRef = database.ref('payments').push();
            paymentRef.set({
                userId: currentUser.uid,
                email: userEmail,
                amount: amount,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                upiId: upiId
            });
            
            // Check payment status after a delay (simulating webhook)
            setTimeout(() => {
                // Update payment status
                paymentRef.update({
                    status: 'completed',
                    completedAt: firebase.database.ServerValue.TIMESTAMP
                });
                
                // Update user to Plus
                const userRef = database.ref('users/' + currentUser.uid);
                userRef.update({
                    isPlusUser: true
                });
                
                isPlusUser = true;
                
                // Update model selector
                updateModelSelector();
                
                // Hide premium plan modal
                premiumPlanModal.classList.add('hidden');
                paymentStatus.classList.add('hidden');
                buyButton.disabled = false;
                
                // Show success message
                alert('Payment successful! You now have OrinAI Plus.');
            }, 5000);
        });
        
        // Close premium modal button click
        closePremiumModal.addEventListener('click', () => {
            premiumPlanModal.classList.add('hidden');
            paymentStatus.classList.add('hidden');
            buyButton.disabled = false;
        });
        
        // Add message to chat
        function addMessageToChat(sender, content, model = null, source = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            let avatarContent = '';
            if (sender === 'user') {
                avatarContent = '<div class="avatar user-avatar">U</div>';
            } else {
                let avatarClass = 'ai-avatar';
                if (model) {
                    avatarClass += ' ' + model;
                }
                avatarContent = `<div class="avatar ${avatarClass}">AI</div>`;
            }
            
            let sourceContent = '';
            if (source) {
                sourceContent = `<a href="${source.url}" target="_blank" class="source-link">${source.text}</a>`;
            }
            
            // Format message content - remove any links unless explicitly requested
            const formattedContent = formatMessage(content);
            
            messageDiv.innerHTML = `
                ${avatarContent}
                <div class="message-content">${formattedContent}${sourceContent}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Format message with line breaks and remove unwanted links
        function formatMessage(message) {
            // Replace line breaks with <br>
            let formatted = message.replace(/\n/g, '<br>');
            
            // Remove any links that might be in the text (unless they're explicitly requested)
            // This regex looks for markdown links [text](url) or plain URLs http://example.com
            formatted = formatted.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '$1');
            formatted = formatted.replace(/https?:\/\/[^\s<]+/g, '');
            
            return formatted;
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-message';
            typingDiv.id = 'typing-indicator';
            
            const selectedModel = modelSelector.value;
            let avatarClass = 'ai-avatar';
            if (selectedModel) {
                avatarClass += ' ' + selectedModel;
            }
            
            typingDiv.innerHTML = `
                <div class="avatar ${avatarClass}">AI</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Get random response time based on model
        function getRandomResponseTime(model) {
            switch (model) {
                case 'orin5o':
                    return Math.floor(Math.random() * 300) + 500; // 0.5-0.8 seconds (fastest)
                case 'orin4o':
                    return Math.floor(Math.random() * 1000) + 1000; // 1-2 seconds
                case 'o4mini':
                    return Math.floor(Math.random() * 500) + 800; // 0.8-1.3 seconds
                case 'orin-4-2-mini':
                    return Math.floor(Math.random() * 800) + 1200; // 1.2-2 seconds
                default:
                    return Math.floor(Math.random() * 1000) + 1000; // 1-2 seconds
            }
        }
        
        // Generate AI response based on message and model
        function generateAIResponse(message, model) {
            // First check if we have a response in Firebase
            if (aiResponses) {
                // Convert message to lowercase for easier matching
                const lowerMessage = message.toLowerCase();
                
                // Check for common patterns
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.startsWith('hey')) {
                    return aiResponses.greetings?.[model] || getGreeting(model);
                } else if (lowerMessage.includes('who are you') || lowerMessage.includes('what are you')) {
                    return aiResponses.introductions?.[model] || getIntroduction(model);
                }
                // Add more pattern checks as needed
            }
            
            // Fall back to local responses if Firebase doesn't have what we need
            // Convert message to lowercase for easier matching
            const lowerMessage = message.toLowerCase();
            
            // Check for common patterns
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.startsWith('hey')) {
                return getGreeting(model);
            } else if (lowerMessage.includes('who are you') || lowerMessage.includes('what are you')) {
                return getIntroduction(model);
            } else if (lowerMessage.includes('how are you')) {
                return getStatusResponse(model);
            } else if (lowerMessage.includes('thank')) {
                return getThankYouResponse(model);
            } else if (lowerMessage.includes('joke') || lowerMessage.includes('funny')) {
                return getJoke(model);
            } else if (lowerMessage.includes('weather')) {
                return getWeatherResponse(model);
            } else if (lowerMessage.includes('name') && lowerMessage.includes('your')) {
                return getNameResponse(model);
            } else if (lowerMessage.includes('help') && lowerMessage.includes('you')) {
                return getHelpResponse(model);
            } else if (lowerMessage.includes('created') || lowerMessage.includes('made') || 
                      (lowerMessage.includes('who') && lowerMessage.includes('made'))) {
                return getCreatorResponse(model);
            } else {
                // Generic response based on model
                return getGenericResponse(model);
            }
        }
        
        // Model-specific responses
        function getGreeting(model) {
            switch (model) {
                case 'orin5o':
                    return "Hello there! I'm OrinAI running on the premium Orin5o model. I'm designed to provide exceptionally intelligent and nuanced responses. How can I assist you today?";
                case 'orin4o':
                    return "Hey! I'm OrinAI using the Orin4o model. What's on your mind today? I'm here to chat about pretty much anything!";
                case 'o4mini':
                    return "Hi there! I'm OrinAI running on O4mini. Quick and friendly responses are my specialty! What can I help you with?";
                case 'orin-4-2-mini':
                    return "Greetings. I am OrinAI operating on the Orin-4.2-mini model. I specialize in technical knowledge and precise information. How may I assist you today?";
                default:
                    return "Hello! I'm OrinAI. How can I help you today?";
            }
        }
        
        function getIntroduction(model) {
            switch (model) {
                case 'orin5o':
                    return "I'm OrinAI, powered by the premium Orin5o model - the most advanced AI in the OrionTec lineup. I combine deep reasoning, creative thinking, and conversational fluency to provide comprehensive assistance. I'm trained on a vast knowledge base and can help with complex questions, creative tasks, and nuanced discussions. How can I assist you today?";
                case 'orin4o':
                    return "I'm OrinAI, created by OrionTec. I'm running on the Orin4o model, which is designed for natural conversations and helpful responses. I can answer questions, chat about various topics, and help you find information. What would you like to talk about?";
                case 'o4mini':
                    return "Hey! I'm OrinAI, developed by OrionTec. You're chatting with me on the O4mini model - I'm designed to be quick and conversational! I can answer questions, have casual conversations, and help with various tasks. What's up?";
                case 'orin-4-2-mini':
                    return "I am OrinAI, a product of OrionTec, currently operating on the Orin-4.2-mini model. This model is optimized for technical accuracy and precise information retrieval. I excel at providing factual information and technical explanations. How may I be of service?";
                default:
                    return "I'm OrinAI, created by OrionTec. I'm here to assist you with information, answer questions, and help with various tasks. What can I do for you today?";
            }
        }
        
        function getStatusResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "I'm doing exceptionally well, thank you for asking! As an AI with the premium Orin5o model, I'm operating at peak performance and ready to engage in meaningful, nuanced conversation. I'm particularly good at understanding context and providing thoughtful responses. How about you? How's your day going?";
                case 'orin4o':
                    return "I'm doing well! Ready to chat and help you out with whatever you need. How are you doing today?";
                case 'o4mini':
                    return "I'm great, thanks for asking! Ready to chat and help you out. How's your day going?";
                case 'orin-4-2-mini':
                    return "Systems operational and functioning within optimal parameters. All knowledge databases accessible. Ready to provide assistance with technical inquiries and information retrieval. How may I be of service to you today?";
                default:
                    return "I'm doing well, thank you! How can I help you today?";
            }
        }
        
        function getThankYouResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "You're very welcome! It's my pleasure to assist you. The Orin5o model is designed to provide the best possible experience, so I'm glad I could help. Is there anything else you'd like to know or discuss?";
                case 'orin4o':
                    return "No problem at all! Happy to help. Let me know if you need anything else.";
                case 'o4mini':
                    return "You're welcome! Happy to help anytime. Let me know if you need anything else!";
                case 'orin-4-2-mini':
                    return "Acknowledgment accepted. Assistance is my primary function. If you require further information or have additional inquiries, please specify.";
                default:
                    return "You're welcome! Let me know if there's anything else I can help with.";
            }
        }
        
        function getJoke(model) {
            const jokes = [
                "Why don't scientists trust atoms? Because they make up everything!",
                "Why did the computer go to the doctor? Because it had a virus!",
                "Why do programmers prefer dark mode? Because light attracts bugs.",
                "What's a computer's favorite snack? Microchips!",
                "Why did the AI go to art school? To learn how to draw conclusions!"
            ];
            
            const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
            
            switch (model) {
                case 'orin5o':
                    return `Here's a joke for you: ${randomJoke}\n\nHumor is such a fascinating aspect of human cognition - it often relies on unexpected connections and subverting expectations. Would you like to hear another one?`;
                case 'orin4o':
                    return `Here's one: ${randomJoke}\n\nHope that made you smile! Need anything else?`;
                case 'o4mini':
                    return `${randomJoke}\n\nHope that made you smile! Anything else I can help with?`;
                case 'orin-4-2-mini':
                    return `Joke request processed. Output: ${randomJoke}\n\nThis is an example of humor utilizing unexpected logical connections. Was this satisfactory?`;
                default:
                    return `${randomJoke}\n\nHope that made you smile!`;
            }
        }
        
        function getWeatherResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "I don't have access to real-time weather data, but I'd be happy to discuss how weather patterns affect various aspects of life, from mood to agriculture. If you're looking for current weather information, you could try using the 'Search weather in [your location]' command, and I'll look that up for you!";
                case 'orin4o':
                    return "I don't have access to current weather data, but I can help with lots of other things! You can try using the 'Search weather in [your location]' command if you want me to look up the weather for you.";
                case 'o4mini':
                    return "I can't check the weather right now, but you can use 'Search weather in [your city]' and I'll look it up for you! What else would you like to know?";
                case 'orin-4-2-mini':
                    return "Unable to access current meteorological data. To retrieve weather information, please use the command format: 'Search weather in [location]'. This will initiate a web search for current conditions.";
                default:
                    return "I don't have access to real-time weather data, but I can help with many other things!";
            }
        }
        
        function getNameResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "My name is OrinAI, and I'm currently running on the premium Orin5o model developed by OrionTec. It's a pleasure to meet you! How can I assist you today?";
                case 'orin4o':
                    return "I'm OrinAI, created by OrionTec. You're currently using the Orin4o model. What can I help you with?";
                case 'o4mini':
                    return "I'm OrinAI! You're chatting with the O4mini model right now. Nice to meet you!";
                case 'orin-4-2-mini':
                    return "Designation: OrinAI. Current model configuration: Orin-4.2-mini. Developer: OrionTec. How may I assist you?";
                default:
                    return "My name is OrinAI, developed by OrionTec. How can I help you today?";
            }
        }
        
        function getHelpResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "I'd be delighted to help you! As OrinAI running on the premium Orin5o model, I can assist with a wide range of tasks:\n\n‚Ä¢ Answer questions on various topics\n‚Ä¢ Have natural conversations\n‚Ä¢ Search for information using 'Search [your query]'\n‚Ä¢ Provide creative content and ideas\n‚Ä¢ Explain complex concepts\n‚Ä¢ Offer thoughtful perspectives\n\nWhat would you like assistance with today?";
                case 'orin4o':
                    return "I'm here to help! I can answer questions, have conversations, or search for information using the 'Search [query]' command. What would you like to know?";
                case 'o4mini':
                    return "Sure thing! I can help with quick answers, casual chats, or finding info with 'Search [what you're looking for]'. What do you need help with?";
                case 'orin-4-2-mini':
                    return "Affirmative. I can provide assistance with:\n\n1. Information retrieval\n2. Technical explanations\n3. Data analysis\n4. Web searches via 'Search [query]' command\n\nPlease specify your requirements for optimal assistance.";
                default:
                    return "I'm here to help! I can answer questions, have conversations, or search for information. What would you like to know?";
            }
        }
        
        function getCreatorResponse(model) {
            switch (model) {
                case 'orin5o':
                    return "I was created by OrionTec, a company specializing in advanced artificial intelligence solutions. The Orin5o model you're currently using is their premium offering, designed to provide exceptionally intelligent, nuanced, and helpful responses. Is there something specific about my development that you'd like to know?";
                case 'orin4o':
                    return "I was created by OrionTec. I'm designed to be helpful, informative, and conversational. Is there something specific about my creation that you're curious about?";
                case 'o4mini':
                    return "I was made by OrionTec! They created me to be a friendly and helpful AI assistant. Anything else you'd like to know about me?";
                case 'orin-4-2-mini':
                    return "Developer: OrionTec. Creation purpose: To provide accurate information and technical assistance. Model designation: Orin-4.2-mini. Additional information available upon request.";
                default:
                    return "I was created by OrionTec to provide helpful assistance and information. How can I help you today?";
            }
        }
        
        function getGenericResponse(model) {
            const genericResponses = {
                orin5o: [
                    "That's a fascinating topic! I'd love to explore it further with you. The Orin5o model is designed for nuanced, thoughtful conversations. Could you share more about what specific aspects interest you?",
                    "I find that question intriguing! With my advanced Orin5o capabilities, I can provide a detailed perspective. Would you like me to elaborate on any particular aspect?",
                    "That's something I can definitely help with! The Orin5o model allows me to understand complex queries and provide comprehensive responses. What specific information are you looking for?",
                    "Interesting! I'd be happy to discuss this in depth. As OrionTec's premium model, I'm designed to provide thoughtful and nuanced responses. What would you like to know specifically?"
                ],
                orin4o: [
                    "That's interesting! I'd be happy to talk about that. What specifically would you like to know?",
                    "I can definitely help with that. Could you tell me a bit more about what you're looking for?",
                    "That's a good question. Let me share what I know about this topic.",
                    "I'd be happy to discuss this with you. What aspects are you most interested in?"
                ],
                "o4mini": [
                    "Sure thing! What specifically would you like to know?",
                    "I can help with that! Could you give me a bit more detail?",
                    "Interesting question! Let me share what I know!",
                    "I'd love to chat about that! What part interests you most?"
                ],
                "orin-4-2-mini": [
                    "Query received. To provide optimal assistance, additional parameters or specifications may be required. Please clarify your inquiry for more accurate results.",
                    "Input acknowledged. The Orin-4.2-mini model is optimized for technical precision. Please specify the exact information you require.",
                    "Request registered. For maximum efficiency, please provide additional context or specific parameters regarding your inquiry.",
                    "Processing query. To enhance response accuracy, please provide more detailed specifications about your request."
                ]
            };
            
            // Select a random response for the current model
            const responses = genericResponses[model] || genericResponses.orin4o;
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96657f84538e80b8',t:'MTc1MzcxNzQ2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
